<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Green Cloud</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Access-Control-Allow-Origin" content="*" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../dist/css/adminlte.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <div th:include="top.html::top"></div>
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>设备管理</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="home">主页</a></li>
              <li class="breadcrumb-item active">设备管理</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header no-border">
                <h3 class="card-title">我的设备</h3>
                <div class="card-tools">
                  <a href="#" class="btn btn-tool btn-sm">
                    <i class="fa fa-download"></i>
                  </a>
                  <a href="#" class="btn btn-tool btn-sm">
                    <i class="fa fa-bars"></i>
                  </a>
                </div>
              </div>
              <div class="card-body p-0">
                <table  style="height:400px;" class="table table-striped table-valign-middle">
                  <thead>
                  <tr>
                    <th>设备名称</th>
                    <th>传感器1</th>
                    <th>传感器2</th>
                    <th>传感器3</th>
                    <th>传感器4</th>
                    <th>传感器5</th>
                    <th>操作</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="dev,devstate:${devlist}" >
                    <td  th:text="${dev.devName}">
                      <img src="dist/img/default-150x150.png" alt="Product 1" class="img-circle img-size-32 mr-2">
                      树莓派
                    </td>
                    <td th:text="${dev.sensorOne}">3</td>
                    <td th:text="${dev.sensorTwo}">3</td>
                    <td th:text="${dev.sensorThree}">3</td>
                    <td th:text="${dev.sensorFour}">3</td>
                    <td th:text="${dev.sensorFive}">3</td>
                    <td>
                      <button type="button"  th:onclick="'javascript:delDev(\''+${dev.devName}+'\')'">删除设备</button>
                      <!--<a href="#" class="text-muted">-->
                        <!--<i class="fa fa-search"></i>-->
                      <!--</a>-->
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- /.card -->
          </div>
          <!-- left column -->
          <div class="col-md-6">
            <!-- general form elements -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">添加设备</h3>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <form role="form">
                <div class="card-body">
                  <div class="form-group">
                    <label for="name">设备名称</label>
                    <input type="text" class="form-control" id="name" placeholder="设备名称">
                  </div>
                  <div class="form-group">
                    <label for="sensor1">传感器1名称</label>
                    <input type="text" class="form-control" id="sensor1" placeholder="传感器">
                  </div>
                  <div class="form-group">
                    <label for="sensor2">传感器2名称</label>
                    <input type="text" class="form-control" id="sensor2" placeholder="传感器">
                  </div>
                  <div class="form-group">
                    <label for="sensor3">传感器3名称</label>
                    <input type="text" class="form-control" id="sensor3" placeholder="传感器">
                  </div>
                  <div class="form-group">
                    <label for="sensor4">传感器4名称</label>
                    <input type="text" class="form-control" id="sensor4" placeholder="传感器">
                  </div>
                  <div class="form-group">
                    <label for="sensor5">传感器5名称</label>
                    <input type="text" class="form-control" id="sensor5" placeholder="传感器">
                  </div>
                  <div  th:object="${session.user}" class="form-group" hidden>
                    <label th:text="*{apiKey}"for="apikey">传感器5名称</label>
                    <input th:value="*{apiKey}" type="text" class="form-control" id="apikey" placeholder="apikey">
                  </div>
                  <!--<div class="form-group">-->
                    <!--<label for="exampleInputFile">File input</label>-->
                    <!--<div class="input-group">-->
                      <!--<div class="custom-file">-->
                        <!--<input type="file" class="custom-file-input" id="exampleInputFile">-->
                        <!--<label class="custom-file-label" for="exampleInputFile">Choose file</label>-->
                      <!--</div>-->
                      <!--<div class="input-group-append">-->
                        <!--<span class="input-group-text" id="">Upload</span>-->
                      <!--</div>-->
                    <!--</div>-->
                  <!--</div>-->
                  <!--<div class="form-check">-->
                    <!--<input type="checkbox" class="form-check-input" id="exampleCheck1">-->
                    <!--<label class="form-check-label" for="exampleCheck1">Check me out</label>-->
                  <!--</div>-->
                </div>
                <!-- /.card-body -->

                <div class="card-footer">
                  <button id="btn" onclick="addDev()" type="button" class="btn btn-primary">添加</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>



    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <div th:replace="foot.html::copyright"></div>


  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="../plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../dist/js/demo.js"></script>
<script src="../page/layer/layer.js"></script>
<script>
  var apiKey = document.getElementById("apikey").getAttribute("value");
  var addurl = 'http://123.207.124.113:8888/api/dev/'+apiKey;
  var deletedevurl =  'http://123.207.124.113:8888/api/user/dev/'+apiKey+'/';
    function getdom(id) {
        return document.getElementById(id);
    }
    function addDev(){
        data = {
            "devName":getdom("name").value,
            "sensorOne":getdom("sensor1").value,
            "sensorTwo":getdom("sensor2").value,
            "sensorThree":getdom("sensor3").value,
            "sensorFour":getdom("sensor4").value,
            "sensorFive":getdom("sensor5").value
        }
        $.ajax({
            method:'POST',
            url:addurl,
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success:function(result){
                layer.alert(result.message)
            }
        })
  }

  var delDev = function (devname) {
      layer.confirm('确定删除该设备？', {
          btn: ['确定','取消'] //按钮
      }, function(){
          $.ajax({
              url: deletedevurl+devname,
              type: 'DELETE',
              success: function(result) {
                  layer.msg('删除成功', {icon: 1});
              }
          });
      }, function(){
          // layer.msg('也可以这样', {
          //     time: 20000, //20s后自动关闭
          //     btn: ['明白了', '知道了']
          });

  }

</script>
</body>
</html>
